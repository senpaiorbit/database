<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>DB Movie Importer</title>

<style>
body{margin:0;font-family:monospace;background:#020617;color:#e5e7eb}
.container{max-width:900px;margin:auto;padding:15px}
.drop{border:2px dashed #38bdf8;padding:20px;text-align:center}
textarea{width:100%;min-height:220px;background:#020617;color:#e5e7eb;border:1px solid #334155;padding:10px}
button{padding:10px 18px;background:#22c55e;border:0;font-size:16px}
.log{background:#000;padding:10px;margin-top:10px;height:200px;overflow:auto}
.status{margin-bottom:10px}
@media(max-width:600px){textarea{min-height:180px}}
</style>
</head>

<body>
<div class="container">

<h2>üé¨ Movie JSON Import</h2>

<div class="status" id="dbStatus">DB: checking‚Ä¶</div>

<div class="drop" onclick="file.click()">üìÇ Drop JSON or Tap</div>
<input id="file" type="file" hidden>

<textarea id="json"></textarea>
<br><br>
<button onclick="upload()">Upload</button>

<div class="log" id="log"></div>

</div>

<script>
const logBox = document.getElementById("log");
const jsonBox = document.getElementById("json");
const dbStatus = document.getElementById("dbStatus");
const file = document.getElementById("file");

function log(t){logBox.textContent+=t+"\n";logBox.scrollTop=99999;}

file.onchange=e=>{
  const r=new FileReader();
  r.onload=()=>jsonBox.value=r.result;
  r.readAsText(e.target.files[0]);
};

async function checkDB(){
  const r=await fetch("/api/m_upload?ping=1");
  const j=await r.json();
  dbStatus.textContent="DB: "+(j.db_connect?"Connected ‚úî":"Failed ‚ùå");
}
checkDB();

async function upload(){
  log("Uploading...");
  const res = await fetch("/api/m_upload",{method:"POST",body:jsonBox.value});
  const text = await res.text();

  try{
    const j = JSON.parse(text);
    (j.logs||[]).forEach(l=>log(l));
    log("DONE ‚úî Inserted:"+j.inserted+" Skipped:"+j.skipped);
  }catch{
    log("‚ùå Invalid JSON response:");
    log(text);
  }
}
</script>
</body>
</html>
